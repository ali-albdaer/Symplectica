<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar System Simulation</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #000; color: #e0e0e0; font-family: 'Segoe UI', system-ui, sans-serif; }
    #canvas-container { position: absolute; inset: 0; z-index: 0; }
    canvas { width: 100% !important; height: 100% !important; display: block; }

    /* HUD overlay */
    #hud { position: absolute; top: 0; left: 0; right: 0; z-index: 10; pointer-events: none; }
    #hud > * { pointer-events: auto; }

    /* Top bar */
    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 16px; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .top-bar .sim-info { display: flex; gap: 16px; font-size: 13px; }
    .top-bar .sim-info span { opacity: 0.8; }
    .top-bar .sim-info .label { opacity: 0.5; margin-right: 4px; }

    /* Controls panel */
    .controls {
      position: absolute; top: 48px; right: 8px; width: 280px;
      background: rgba(10,10,20,0.85); backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      padding: 12px; font-size: 13px;
    }
    .controls h3 { font-size: 14px; margin-bottom: 8px; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
    .controls .row { display: flex; justify-content: space-between; align-items: center; margin: 4px 0; }
    .controls button {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
      color: #e0e0e0; padding: 4px 12px; border-radius: 4px; cursor: pointer;
      transition: background 0.15s;
    }
    .controls button:hover { background: rgba(255,255,255,0.2); }
    .controls button.active { background: rgba(80,140,255,0.3); border-color: rgba(80,140,255,0.5); }
    .controls select, .controls input {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15);
      color: #e0e0e0; padding: 3px 8px; border-radius: 3px; font-size: 12px;
    }
    .controls select { min-width: 120px; }
    .controls input[type="range"] { width: 120px; }

    /* Body list */
    .body-list {
      position: absolute; top: 48px; left: 8px; width: 220px;
      background: rgba(10,10,20,0.85); backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      padding: 12px; font-size: 13px; max-height: calc(100vh - 64px); overflow-y: auto;
    }
    .body-list h3 { font-size: 14px; margin-bottom: 8px; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
    .body-item {
      display: flex; align-items: center; gap: 8px; padding: 4px 8px;
      border-radius: 4px; cursor: pointer; transition: background 0.15s;
    }
    .body-item:hover { background: rgba(255,255,255,0.1); }
    .body-item.selected { background: rgba(80,140,255,0.2); }
    .body-item .dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .body-item .name { flex: 1; }
    .body-item .type { opacity: 0.4; font-size: 11px; }

    /* Diagnostics */
    .diagnostics {
      position: absolute; bottom: 8px; left: 8px;
      background: rgba(10,10,20,0.85); backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      padding: 8px 12px; font-size: 11px; font-family: 'Consolas', monospace;
      opacity: 0.9;
    }
    .diagnostics .row { display: flex; gap: 12px; }
    .diagnostics .label { opacity: 0.4; }
    .diagnostics .warn { color: #ffa500; }
    .diagnostics .error { color: #ff4444; }

    /* Loading screen */
    #loading {
      position: absolute; inset: 0; z-index: 100;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      background: #050510; transition: opacity 0.5s;
    }
    #loading.hidden { opacity: 0; pointer-events: none; }
    #loading h1 { font-size: 32px; font-weight: 300; margin-bottom: 16px; letter-spacing: 2px; }
    #loading .subtitle { opacity: 0.5; font-size: 14px; }
    .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #5090ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 24px; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="loading">
    <h1>Solar System Simulation</h1>
    <div class="spinner"></div>
    <div class="subtitle">Initializing physics engine...</div>
  </div>

  <div id="canvas-container"></div>

  <div id="hud">
    <div class="top-bar">
      <div class="sim-info">
        <span><span class="label">Tick:</span><span id="hud-tick">0</span></span>
        <span><span class="label">Time:</span><span id="hud-time">0s</span></span>
        <span><span class="label">Bodies:</span><span id="hud-bodies">0</span></span>
        <span><span class="label">FPS:</span><span id="hud-fps">0</span></span>
      </div>
      <div class="sim-info">
        <span id="hud-connection" style="opacity:0.5">Offline</span>
      </div>
    </div>

    <div class="body-list" id="body-list">
      <h3>Bodies</h3>
      <div id="body-list-items"></div>
    </div>

    <div class="controls" id="controls">
      <h3>Simulation</h3>
      <div class="row">
        <span>State</span>
        <div>
          <button id="btn-pause">⏸ Pause</button>
          <button id="btn-step">⏭ Step</button>
        </div>
      </div>
      <div class="row">
        <span>Time Scale</span>
        <input type="range" id="time-scale" min="-2" max="6" step="0.1" value="0" />
      </div>
      <div class="row">
        <span id="time-scale-label">1x</span>
      </div>

      <h3 style="margin-top:12px">Camera</h3>
      <div class="row">
        <span>Mode</span>
        <select id="camera-mode">
          <option value="orbit" selected>Orbit</option>
          <option value="chase">Chase</option>
          <option value="freefly">Free Fly</option>
        </select>
      </div>

      <h3 style="margin-top:12px">Engine</h3>
      <div class="row">
        <span>Solver</span>
        <select id="solver-select">
          <option value="Direct" selected>Direct O(N²)</option>
          <option value="BarnesHut">Barnes-Hut</option>
          <option value="FMM">FMM</option>
        </select>
      </div>
      <div class="row">
        <span>Integrator</span>
        <select id="integrator-select">
          <option value="VelocityVerlet" selected>Velocity Verlet</option>
          <option value="RK45">RK4(5)</option>
          <option value="GaussRadau15">IAS15</option>
        </select>
      </div>

      <h3 style="margin-top:12px">Presets</h3>
      <div class="row" style="flex-wrap:wrap; gap:4px;">
        <button class="preset-btn" data-preset="two_body">Two Body</button>
        <button class="preset-btn" data-preset="sun_earth_moon">Sun-Earth-Moon</button>
        <button class="preset-btn" data-preset="solar_system">Solar System</button>
        <button class="preset-btn" data-preset="binary_star">Binary Star</button>
        <button class="preset-btn" data-preset="asteroid_belt">Asteroid Belt</button>
      </div>

      <h3 style="margin-top:12px">World Builder</h3>
      <div id="world-builder">
        <div class="row">
          <span>Name</span>
          <input type="text" id="wb-name" placeholder="Body name" value="Custom" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Type</span>
          <select id="wb-type" style="width:100px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;">
            <option value="Star">Star</option>
            <option value="Planet" selected>Planet</option>
            <option value="Moon">Moon</option>
            <option value="Asteroid">Asteroid</option>
            <option value="Comet">Comet</option>
            <option value="TestParticle">Test Particle</option>
          </select>
        </div>
        <div class="row">
          <span>Mass (kg)</span>
          <input type="text" id="wb-mass" value="5.97e24" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Radius (m)</span>
          <input type="text" id="wb-radius" value="6.37e6" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Pos X (m)</span>
          <input type="text" id="wb-px" value="1.5e11" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Pos Y (m)</span>
          <input type="text" id="wb-py" value="0" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Pos Z (m)</span>
          <input type="text" id="wb-pz" value="0" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Vel X (m/s)</span>
          <input type="text" id="wb-vx" value="0" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Vel Y (m/s)</span>
          <input type="text" id="wb-vy" value="2.98e4" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Vel Z (m/s)</span>
          <input type="text" id="wb-vz" value="0" style="width:80px;background:#222;border:1px solid #555;color:#eee;padding:2px 4px;border-radius:3px;" />
        </div>
        <div class="row">
          <span>Color</span>
          <input type="color" id="wb-color" value="#3366cc" style="width:30px;height:24px;border:none;background:none;cursor:pointer;" />
        </div>
        <div class="row" style="margin-top:4px; gap:4px;">
          <button id="wb-add" style="flex:1;">✚ Add Body</button>
          <button id="wb-delete" style="flex:1;">✕ Delete Selected</button>
        </div>
        <div class="row" style="gap:4px;">
          <button id="wb-circular" style="flex:1; font-size:10px;">⟳ Circular Orbit</button>
        </div>
      </div>
    </div>

    <div class="diagnostics" id="diagnostics">
      <div class="row">
        <span><span class="label">E_err:</span><span id="diag-energy">0</span></span>
        <span><span class="label">p_err:</span><span id="diag-momentum">0</span></span>
        <span><span class="label">Solver:</span><span id="diag-solver">Direct</span></span>
        <span><span class="label">dt:</span><span id="diag-dt">0</span></span>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
